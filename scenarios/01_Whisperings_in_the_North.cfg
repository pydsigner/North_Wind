[scenario]
    id=01_Whisperings_in_the_North
    name= _ "Whisperings in the North"
    map_data="{~add-ons/The_North_Wind/maps/01_Whisperings_in_the_North.map}"

    next_scenario=null

    {NW_FULL_DAY}

    [music]
        name="nunc_dimittis.ogg"
    [/music]

    turns=-1
    victory_when_enemies_defeated=no

    # Scenario Introduction - Whisperings in the North
    {NW_WHISPERINGS_IN_THE_NORTH}

    # The North Wind Riders
    [side]
        side=1
        type=Horseman Commander
        name="Deoran"
        id=Deoran
        unrenamable=yes
        canrecruit=yes
        profile=portraits/deoran_knight.png

        [modifications]
            {TRAIT_STRONG}
            {TRAIT_QUICK}
        [/modifications]

        team_name=North_Wind
        user_team_name=_ "team_name^Deoran"
        controller=human
        {CUSTOM_NW_FLAG}

        gold=60
        {NO_INCOME}
    [/side]

    # The Ambushing Goblins
    [side]
        side=2
        no_leader=yes

        team_name=goblins
        user_team_name=_ "team_name^Goblins"
        controller=ai
        {FLAG_VARIANT ragged}

        gold=0
        {NO_INCOME}

        [ai]
            {ATTACK_DEPTH 1 2 3}
            caution=-0.5
            {QUANTITY aggression 0.6 0.7 0.8}
            [goal]
                [criteria]
                    side=1
                [/criteria]
                value=4
            [/goal]
        [/ai]
    [/side]

#define ORCISH_WARBAND_AI
    [ai]
        {ATTACK_DEPTH 2 3 4}
        {QUANTITY caution 0.3 0.4 0.4}
        {QUANTITY aggression 1.0 0.9 0.9}
        grouping=no
        [goal]
            [criteria]
                side=1
            [/criteria]
            {QUANTITY value 1.3 1.4 1.5}
        [/goal]
    [/ai]
#enddef

    # The Sharp Claw Band
    [side]
        side=3
        no_leader=yes

        team_name=sharp_claw
        user_team_name=_ "team_name^Sharp Claw Band"
        controller=ai
        {FLAG_VARIANT ragged}

        gold=0
        {NO_INCOME}

        {ORCISH_WARBAND_AI}
    [/side]

    # The Blood Foot Clan
    [side]
        side=4
        no_leader=yes

        team_name=blood_foot
        user_team_name=_ "team_name^Blood Foot Clan"
        controller=ai
        {FLAG_VARIANT ragged}

        gold=0
        income=-2

        {ORCISH_WARBAND_AI}
    [/side]

    # Remnants of the Bright Spears
    [side]
        side=5
        no_leader=yes

        team_name=North_Wind
        user_team_name=_ "team_name^Bright Spears"
        controller=ai

        gold=0
        income=0
    [/side]

    # Scenario Pre-start
    [event]
        name=prestart

        # Build the Bright Spears' Camp
        {PLACE_IMAGE "scenery/well.png" 22 17}

        # Add the North Wind Riders
        [unit]
            {QUANTITY type Paladin Knight Knight}
            name="Theorem"
            id=Theorem
            {IS_HERO}
            side=1
            x,y=10,34
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        [unit]
            {QUANTITY type Knight Knight Horseman}
            name="Dageth"
            id=Dageth
            side=1
            x,y=9,34
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        [unit]
            {QUANTITY type Lancer Knight Horseman}
            name="Alefas"
            id=Alefas
            side=1
            x,y=8,34
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]

        [unit]
            {QUANTITY type Pikeman Spearman Spearman}
            name="Owyran"
            id=Owyran
            side=1
            x,y=10,33
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        [unit]
            {QUANTITY type Longbowman Bowman Bowman}
            name="Sarraent"
            id=Sarraent
            side=1
            x,y=8,33
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        [unit]
            {QUANTITY type Longbowman Bowman Bowman}
            name="Owur"
            id=Owur
            side=1
            x,y=11,35
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]

        [unit]
            {QUANTITY type Swordsman Spearman Spearman}
            name="Aetharcyn"
            id=Aetharcyn
            side=1
            x,y=7,35
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        # Initialise the event variables for the scenario.
        {VARIABLE event_random_ambushers no}
        {VARIABLE event_camp_reached no}
        {VARIABLE event_orcish_raid no}
        {VARIABLE event_orcs_defeated no}
    [/event]

    # Scenario Start - A Goblin Ambush
    [event]
        name=start

        {SELECT_SOLDIER}
        [message]
            speaker=$soldier
            message= _ "We've been riding for days, and the last inn was miles ago... How much further must we travel?"
        [/message]
        [message]
            speaker=Deoran
            message= _ "The Bright Spears' encampment is just ahead. Lieutenant Paulus will welcome us, and there will be food and shelter, even if it is not the soft beds and fine ale of the inns of Karelia."
        [/message]

        [sound]
            name="horn-signals/horn-6.ogg"
        [/sound]
        [delay]
            time=400
        [/delay]

        # Specially timed incidental music
        [music]
            name=the_city_falls.ogg
            play_once=yes
            ms_before=3000
        [/music]
        # Very little time will normally elapse between the end of story and
        # this point, so instead of playing the scenario music for a couple of
        # seconds and then playing the incidental, we'll save the scenario
        # playlist for after the incidental music has started.
        [music]
            name="loyalists.ogg"
            append=no
            immediate=no
        [/music]
        {APPEND_MUSIC "knolls.ogg"}

        # Goblin Party One
        [move_unit_fake]
            type=Goblin Rouser
            side=2
            x=3,4,5
            y=32,32,33
        [/move_unit_fake]

        {NAMED_GENERIC_UNIT 2 (Goblin Rouser) 5 33 (A) ( _ "Goblin Ambusher")}

        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 5 34 () ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 6 33 () ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 7 32 () ( _ "Goblin Ambusher")}

        [message]
            speaker=A
            image={PORTRAIT_COMPAT goblins rouser-2}
            message= _ "Ayaiiii!"
        [/message]

        # Goblin Party Two
        [move_unit_fake]
            type=Goblin Impaler
            side=2
            x=10,9,8
            y=37,37,36
        [/move_unit_fake]

        {NAMED_GENERIC_UNIT 2 (Goblin Impaler) 8 36 (B) ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 7 37 () ( _ "Goblin Ambusher")}

        [message]
            speaker=B
            message= _ "Get 'em!"
        [/message]

        # Goblin Party Three
        [move_unit_fake]
            type=Goblin Rouser
            side=2
            x=15,14,13
            y=37,36,36
        [/move_unit_fake]
        {NAMED_GENERIC_UNIT 2 (Goblin Rouser) 13 36 (C) ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 12 34 () ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 12 35 () ( _ "Goblin Ambusher")}

        [message]
            speaker=C
            message= _ "Attack!"
        [/message]

        # Goblin Party Four
        [move_unit_fake]
            type=Goblin Rouser
            side=2
            x=9,10,10,9
            y=30,30,31,32
        [/move_unit_fake]

        {NAMED_GENERIC_UNIT 2 (Goblin Rouser) 9 32 (D) ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 10 32 () ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 10 31 () ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 13 32 () ( _ "Goblin Ambusher")}
        {NAMED_GENERIC_UNIT 2 (Goblin Spearman) 11 32 () ( _ "Goblin Ambusher")}

        [message]
            speaker=D
            message= _ "Ayiie!"
        [/message]

        # Goblin Party Five
        [move_unit_fake]
            type=Goblin Impaler
            side=2
            x=15,14,13,12
            y=32,31,32,32
        [/move_unit_fake]

        {NAMED_GENERIC_UNIT 2 (Goblin Impaler) 12 32 (E) ( _ "Goblin Ambusher")}

        [message]
            speaker=E
            message= _ "They're dead!"
        [/message]

        # The number of ambushers still alive
        {VARIABLE number_of_goblins 15}

        [message]
            speaker=Deoran
            message= _ "Goblins!"
        [/message]
        [message]
            speaker=$soldier
            message= _ "We're surrounded!"
        [/message]
        [message]
            speaker=Deoran
            message= _ "Attack! We've got to break through to the fort!"
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Fight off the Goblin ambush"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Theorem"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    # Force the player to crush the initial ambush quickly
    [event]
        name=turn 5
        [filter_condition]
            [variable]
                name=event_camp_reached
                equals=no
            [/variable]
        [/filter_condition]

        {VARIABLE event_random_ambushers yes}
    [/event]

    # Keep track of living goblins
    [event]
        name=die
        first_time_only=no

        [filter]
            side=2
        [/filter]

        [set_variable]
            name=number_of_goblins
            add=-1
        [/set_variable]
    [/event]

    # The Ambush Weakens and Breaks
    [event]
        name=die
        first_time_only=no

        [filter]
            side=2
        [/filter]
        [filter_condition]
            [variable]
                name=event_random_ambushers
                equals=no
            [/variable]
        [/filter_condition]

        [switch]
            variable=number_of_goblins
            [case]
                value=8

                [message]
                    speaker=Theorem
                    message= _ "Keep fighting, men! They're almost done!"
                [/message]
            [/case]
            [case]
                value=4

                {SELECT_SOLDIER}
                [message]
                    speaker=$soldier
                    message= _ "Just a few left! Don't let any escape!"
                [/message]
            [/case]
            [case]
                value=0

                [message]
                    speaker=Deoran
                    message= _ "That's the last of them!"
                [/message]
                [message]
                    speaker=Theorem
                    message= _ "Commander, how did so many goblins slip past the encampment? Our route back to Tath is cut off!"
                [/message]
                [message]
                    speaker=Deoran
                    message= _ "I do not know, but it makes me fear for the fate of the Bright Spears. Let us hasten to their camp, and see what has become of them."
                [/message]

                [fire_event]
                    name=must reach encampment
                [/fire_event]

                {VARIABLE event_random_ambushers yes}
            [/case]
        [/switch]
    [/event]

    [event]
        name=must reach encampment

        {HIGHLIGHT_IMAGE 21 19 "items/gohere.png" ()}

        [scroll_to_unit]
            id=Deoran
        [/scroll_to_unit]

        [objectives]
            side=1
            [objective]
                description= _ "Deoran must reach the Bright Spears' encampment"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Theorem"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    # More goblins appear and attack!
    [event]
        name=new turn
        first_time_only=no

        [filter_condition]
            [variable]
                name=number_of_goblins
                {QUANTITY less_than 12 16 24}
            [/variable]
            [variable]
                name=event_random_ambushers
                equals=yes
            [/variable]
        [/filter_condition]

        {REPEAT {ON_DIFFICULTY 4 5 8} ({NW_RANDOM_GOBLIN_AMBUSH})}

        [set_variable]
            name=number_of_goblins
            {QUANTITY add 4 5 8}
        [/set_variable]

        [scroll_to_unit]
            role=goblin_ambusher
        [/scroll_to_unit]

        [fire_event]
            name=more goblins
        [/fire_event]
    [/event]

    # Discuss second wave of goblins
    [event]
        name=more goblins

        # Avoid scrolling to the goblins and then immediately jumping back
        [delay]
            time=400
        [/delay]

        [message]
            speaker=Deoran
            message=_ "More goblins are swarming out of the hills! How many can there be!?"
        [/message]
        {SELECT_SOLDIER}
        [message]
            speaker=$soldier
            message=_ "Captain, we'll never make it! All of us bear wounds, and those goblins are fresh and enraged..."
        [/message]
        [message]
            speaker=Deoran
            message=_ "We cannot stand against them! We must reach the camp! Press on, and protect the most grievously wounded..."
        [/message]

        [fire_event]
            name=must reach encampment
        [/fire_event]
    [/event]

    # Deoran Reaches the Bright Spears Camp
    [event]
        name=moveto
        [filter]
            id=Deoran
            x=21
            y=19
        [/filter]

        [sound]
            name="horn-signals/horn-8.ogg"
        [/sound]

        [role]
            role=goblin
            type=Goblin Spearman,Goblin Impaler,Goblin Rouser
        [/role]

        [if]
            [have_unit]
                role=goblin
            [/have_unit]
            [then]
                [message]
                    role=goblin
                    message= _ "Aah! They've reached their camp! Run away! Run!"
                [/message]
                [kill]
                    race=goblin
                    animate=no
                [/kill]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    image={PORTRAIT_COMPAT goblins rouser}
                    caption= _ "Goblin Rouser"
                    message= _ "Aah! They've reached their camp! Run away! Run!"
                [/message]
            [/else]
        [/if]

        {SELECT_SOLDIER}
        [message]
            speaker=$soldier
            message= _ "Ha! They're afraid to attack us while we're in the encampment. We're safe for now."
        [/message]

        [message]
            speaker=Deoran
            message= _ "If they are afraid of the wooden walls of this fort, where are the soldiers of the Bright Spears? I must find Lieutenant Paulus."
        [/message]

        [remove_item]
            x,y=21,19
        [/remove_item]

        [hide_unit]
            x=21
            y=19
        [/hide_unit]

        [message]
            speaker=Deoran
            message= _ "Lieutenant Paulus! Are you here?"
        [/message]

        [message]
            speaker=narrator
            message= _ "..."
            image=wesnoth-icon.png
        [/message]

        [unhide_unit][/unhide_unit]

        [message]
            speaker=Deoran
            message= _ "No one is inside... can they all be dead?"
        [/message]

        [message]
            speaker=$soldier
            message= _ "There is no blood on the ramparts... If the Bright Spears had been killed here, would there not be blood on the walls?"
        [/message]

        [message]
            speaker=Deoran
            message= _ "There is some devilry at work. Their weapons and armour are still in their tents. What can have happened here? How does a whole garrison vanish without a trace?"
        [/message]

        [message]
            speaker=$soldier
            message= _ "Should we send a messenger back to king Konrad?"
        [/message]

        [message]
            speaker=Deoran
            message= _ "The hills behind us are infested with those accursed goblins. I fear that we will be unable to send a messenger..."
        [/message]

        [message]
            speaker=Deoran
            message= _ "For now, men, I want you to search every square inch of this camp. We must find some token of what fate befell the Bright Spears."
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Investigate the Bright Spears' Camp."
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Theorem"
                condition=lose
            [/objective]
        [/objectives]

        # Limit how long the player has to rest and search
        [event]
            name="turn $($turn_number + {ON_DIFFICULTY 4 3 3}) refresh"
            delayed_variable_substitution=no
            [filter_condition]
                [variable]
                    name=event_orcish_raid
                    equals=no
                [/variable]
            [/filter_condition]

            [message]
                speaker=Deoran
                message= _ "I do not understand! There is no sign of struggle, and yet—"
            [/message]

            [fire_event]
                name=orcs attack
            [/fire_event]
        [/event]

        {VARIABLE event_random_ambushers no}
        {CLEAR_VARIABLE number_of_goblins}
        {VARIABLE event_camp_reached yes}
    [/event]

    # Someone finds evidence of the fate of the Bright Spears
    [event]
        name=moveto
        first_time_only=no

        [filter]
            x=22
            y=17
            side=1
        [/filter]
        [filter_condition]
            [variable]
                name=event_camp_reached
                equals=yes
            [/variable]
        [/filter_condition]


        [message]
            speaker=unit
            message= _ "There is nothing but water in the well, and it is blue, unstained..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            x=18,19,21,23,18,23,24
            y=17,16,18,17,20,20,19
            side=1
        [/filter]
        [filter_condition]
            [variable]
                name=event_camp_reached
                equals=yes
            [/variable]
        [/filter_condition]

        [message]
            speaker=unit
            message= _ "Nothing here..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            x=25,26
            y=17,17
            side=1
        [/filter]
        [filter_condition]
            [variable]
                name=event_camp_reached
                equals=yes
            [/variable]
        [/filter_condition]

        [message]
            speaker=unit
            message= _ "Look! There are footprints crossing the ford here!"
        [/message]
        [message]
            speaker=Theorem
            message= _ "Are they the footprints of men or orcs?"
        [/message]
        [message]
            speaker=unit
            message= _ "Many men crossed here; and many orcs as well. From the look of it, more orcs than men!"
        [/message]
        [message]
            speaker=Deoran
            message= _ "Perhaps the Bright Spears were driven into the hills by some orcish assault. But if that were so, why would they have left their weapons and armor? The signs here point to some fell chance."
        [/message]

        [fire_event]
            name=orcs attack
        [/fire_event]
    [/event]

    [event]
        name=orcs attack

        {SELECT_SOLDIER}
        [message]
            speaker=$soldier
            message= _ "Commander! Look! In the hills! Banners!"
        [/message]

        {INCIDENTAL_MUSIC vengeful.ogg}

        # Orcish Raiding Party
        [move_unit_fake]
            type=Orcish Ruler
            side=3
            x=25,25,25,24
            y=9,10,11,11
        [/move_unit_fake]

        [unit]
            type=Orcish Ruler
            name="Garbluk"
            id=Garbluk
            side=3
            canrecruit=yes
            profile={PORTRAIT_COMPAT orcs grunt-5}
            x,y=24,11
        [/unit]

        [message]
            speaker=Garbluk
            message= _ "Those miserable goblins may fear the walls of your camp, but we are orcs of the Sharp Claw band! We fear nothing! We will decorate our walls with your hides!"
        [/message]

        {NAMED_GENERIC_UNIT 3 (Orcish Grunt) 23 12 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 3 (Orcish Archer) 24 12 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 3 (Orcish Grunt) 25 12 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 3 (Orcish Crossbowman) 26 12 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 3 (Orcish Grunt) 25 13 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 3 (Orcish Grunt) 22 12 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 3 (Orcish Crossbowman) 27 11 () ( _ "Raider")}

        # Orcish Raiding Party
        [move_unit_fake]
            type=Orcish Warrior
            side=4
            x=12,13,14,15
            y=14,14,13,14
        [/move_unit_fake]

        [unit]
            type=Orcish Warrior
            name="Gofbak"
            id=Gofbak
            side=4
            canrecruit=yes
            profile={PORTRAIT_COMPAT orcs grunt-4}
            x,y=15,14
        [/unit]

        [message]
            speaker=Gofbak
            message= _ "You don't stand a chance, puny men. If you surrender, we will kill you quickly. If you fight us, you will not be so lucky. No one can hold off the Blood Foot clan!"
        [/message]

        {NAMED_GENERIC_UNIT 4 (Orcish Archer) 15 15 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Assassin) 15 16 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Grunt) 16 15 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Archer) 15 17 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Grunt) 17 15 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Grunt) 16 14 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Archer) 13 18 () ( _ "Raider")}
        {NAMED_GENERIC_UNIT 4 (Orcish Grunt) 15 18 () ( _ "Raider")}

        [message]
            speaker=Garbluk
            message= _ "You would steal our prey, foolish bloody shoe worshipper!"
        [/message]

        [message]
            speaker=Gofbak
            message= _ "Your prey?! Your prey! This is our land! Our prey!"
        [/message]

        [message]
            speaker=Garbluk
            message= _ "Ha! After we kill these puny men, your heads will decorate our spears!"
        [/message]

        # The North Wind riders' response:
        [message]
            speaker=Theorem
            message= _ "I think we now know the fate of the Bright Spears... And I fear that it will be our fate as well. There are not enough of us to man the walls."
        [/message]

        [message]
            speaker=Deoran
            message= _ "Courage, men. We are soldiers of Wesnoth, and if we fall beneath these hills, so we fall. Yet as many of these raiders as we can slay will adorn our graves."
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Survive the Orcish Raid"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Theorem"
                condition=lose
            [/objective]
        [/objectives]

        # Schedule return of the Bright Spears
        [event]
            name="side 1 turn $($turn_number + 1) end"
            delayed_variable_substitution=no

            [fire_event]
                name=bright spears arrive
            [/fire_event]
        [/event]

        {VARIABLE event_orcish_raid yes}
        {CLEAR_VARIABLE event_camp_reached}
    [/event]

    # The Orcs begin to fight among themselves.

    [event]
        name=attack
        [filter]
            side=3
        [/filter]
        [filter_second]
            side=4
        [/filter_second]

        [message]
            speaker=Gofbak
            message= _ "You dare attack us! Fools! We will crush you all!"
        [/message]

        [message]
            speaker=Garbluk
            message= _ "Ha! You and your miserable band couldn't sack a potato! Your bloody stumps will feed our pigs!"
        [/message]

        [message]
            speaker=$soldier
            message= _ "We may have a chance after all! They are killing each other!"
        [/message]
    [/event]

    # Marauders arrive to aid the North Wind riders against the Orcs.
    [event]
        name=bright spears arrive

        [unit]
            type=Marauder Axeman
            name="Vinlar"
            id=Vinlar
            {IS_HERO}
            side=5
            x,y=22,21
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]

        [unit]
            type=Marauder Scout
            name="Jelmar"
            side=5
            x,y=21,22
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        [unit]
            type=Marauder Scout
            name="Ufas"
            side=5
            x,y=24,21
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        [unit]
            type=Marauder Scout
            name="Keras"
            side=5
            x,y=24,22
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        [unit]
            type=Marauder Axeman
            name="Mablung"
            side=5
            x,y=23,23
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]

        [unit]
            type=Marauder Axeman
            name="Rufem"
            side=5
            x,y=25,16
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        [unit]
            type=Marauder Axeman
            name="Orath"
            side=5
            x,y=15,19
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker=Vinlar
            message= _ "Come on men! Reinforcements have arrived! We're saved!"
        [/message]

        [message]
            speaker=Deoran
            message= _ "Hardly saved! Rather you are rescuing us! Whoever you are, though, we will welcome you aid!"
        [/message]

        [message]
            speaker=Vinlar
            message= _ "There will be time for discussion once these orcs are dead and burning. Charge, men!"
        [/message]

        [message]
            speaker=Deoran
            message= _ "Indeed, back to the fight!"
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Survive the Orcish Raid"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Theorem"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Vinlar"
                condition=lose
            [/objective]
        [/objectives]

        {CLEAR_VARIABLE event_orcish_raid}
    [/event]

    # The Orcish Raid is defeated
    [event]
        name=die
        first_time_only=no

        [filter]
            id=Garbluk,Gofbak
        [/filter]

        # Slightly different dialog depending on which leader is defeated first
        {IF_VAR unit.side equals 3 (
            [then]
                {VARIABLE run_message (_ "Garbluk is dead! Run! Back to the hills!")}
                {VARIABLE attack_message (_ "They die! Now, the one who brings me the head of those grass lovers' leader will win their toes!")}
                {VARIABLE other_side 4}
            [/then]
            [else]
                {VARIABLE run_message (_ "Leader is dead! We must warn the others!")}
                {VARIABLE attack_message (_ "They die! Now, the one who brings me the head of those grass lovers' leader will win their fingers!")}
                {VARIABLE other_side 3}
            [/else]
        )}

        # Any remaining units from the defeated warband flee
        [message]
            side=$unit.side
            canrecruit=no
            message=$run_message
        [/message]
        [kill]
            side=$unit.side
            animate=no
        [/kill]

        [if]
            [have_unit]
                side=$other_side
            [/have_unit]
            [then]
                [message]
                    side=$other_side
                    canrecruit=yes
                    message=$attack_message
                [/message]

                [message]
                    speaker=Theorem
                    message= _ "They still want us dead! Stand fast, men."
                [/message]
                [message]
                    speaker=Deoran
                    message= _ "For King Konrad!"
                [/message]

                # This isn't expected to actually trigger anything, but, with sufficient luck and/or unit positioning cheese,
                # the player could actually defeat both bands of orcs before the Bright Spears arrive normally.
                # To avoid awkward dialog, we'll trigger that arrival preemptively if the player kills one of the orc leaders early.
                [fire_event]
                    name=bright spears arrive
                [/fire_event]
            [/then]
            [else]
                [fire_event]
                    name=orcs defeated
                [/fire_event]
            [/else]
        [/if]

        {CLEAR_VARIABLE run_message,attack_message,other_side}
    [/event]

    [event]
        name=orcs defeated

        [message]
            speaker=Deoran
            message= _ "So, whence comes this unlooked for aid? Without your help, we surely would have been lost!"
        [/message]

        [message]
            speaker=Vinlar
            message= _ "My name is Lieutenant Vinlar, second in command of the Bright Spears. The rest of these men are the riders of my house. We were the lucky ones..."
        [/message]

        [message]
            speaker=Deoran
            message= _ "Indeed, we have been trying to solve the riddle of what happened to the Bright Spears, and here you were under our very noses! What news from the north?"
        [/message]

        [message]
            speaker=Vinlar
            message= _ "Ill tidings and a fell wind. We few have been hiding in the hills and forests these past weeks. Before I tell my tale in full, though, I must ask a question: did young Gliddyn reach the king?"
        [/message]

        [message]
            speaker=Deoran
            message= _ "Gliddyn?"
        [/message]

        [message]
            speaker=Vinlar
            message= _ "Paulus sent him with a small party of riders to the king, and he was bearing news and tidings of the battles in the north."
        [/message]

        [message]
            speaker=Deoran
            message= _ "Alas, he alone reached the king, and his wounds were too great. Before the king he fell, having given no tidings save that the orcs were again moving in the north."
        [/message]

        [message]
            speaker=Vinlar
            message= _ "And you have come as the vanguard of the great force that will drive them back into the northern reaches?"
        [/message]

        [message]
            speaker=Deoran
            message= _ "Ha! I am here with those knights and soldiers you see. The king's armies are battling undead foes in the east. No help will come from Wesnoth."
        [/message]

        [message]
            speaker=Vinlar
            message= _ "Then has the night come, and we are not saved. The hills to the south and east of the camp are unsafe, and those orcs will surely return e'er long. We should head west, into the Pass of Shattered Swords. Within lies a village loyal to the crown, and perhaps some of the men there will take up arms and join us."
        [/message]

        [message]
            speaker=Deoran
            message= _ "Well, and proceed there we shall. Yet would I that we rest here for this night; my men are wearied from the journey, and weakened for lack of both blood and sustenance this day."
        [/message]

        [message]
            speaker=Deoran
            message= _ "As for your part, you have not evaded discovery through sleep, and should seek out such equipment as you can still use from your tents, and perhaps take from our spares. Furthermore, you still have not told the fate of Paulus and the men of the Bright Spears, and I would know it e'er we venture forth."
        [/message]

        [message]
            speaker=Vinlar
            message= _ "Very well, you shall hear it this night."
        [/message]

        [endlevel]
            result=victory
            bonus=no
        [/endlevel]
    [/event]

    {DEATH}
    {BONES}
    {SOLDIER_SELECTOR}
[/scenario]
